{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[16],{578:function(s,n,a){\"use strict\";a.r(n);var e=a(10),t=Object(e.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"blockquote\",[a(\"p\",[a(\"strong\",[s._v(\"本文前提：已经绑定了Cloudflare API Key\")])])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_0x00-构建工作目录\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x00-构建工作目录\"}},[s._v(\"#\")]),s._v(\" 0x00 构建工作目录\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"workdir\\n  - compose\\n    -- acme\\n      --- acme.sh \\n      *** Dockerfile\\n    -- nginx\\n      --- conf\\n        **** my.domain.com.conf\\n      --- log\\n      *** Dockerfile\\n  - wwwroot\\n    -- my.domain.com\\n      *** index.html\\n  * docker-compose.yml\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 约定：\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#     - 表示目录\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"#     * 表示文件\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"_0x01-编写nginx的dockerfile\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x01-编写nginx的dockerfile\"}},[s._v(\"#\")]),s._v(\" 0x01 编写nginx的Dockerfile\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-dockerfile line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-dockerfile\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token instruction\"}},[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"FROM\")]),s._v(\" nginx:1.17.5\")]),s._v(\"\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token instruction\"}},[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"COPY\")]),s._v(\" ./compose/nginx/conf/my.domain.com.conf /etc/nginx/conf.d/\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token instruction\"}},[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"COPY\")]),s._v(\" ./compose/acme/acme.sh/my.domain.com/fullchain.cer /etc/letsencrypt/my.domain.com/\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token instruction\"}},[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"COPY\")]),s._v(\" ./compose/acme/acme.sh/my.domain.com/my.domain.com.key /etc/letsencrypt/my.domain.com/\")]),s._v(\"\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"_0x02-编写acme-sh的dockerfile\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x02-编写acme-sh的dockerfile\"}},[s._v(\"#\")]),s._v(\" 0x02 编写acme.sh的Dockerfile\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-dockerfile line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-dockerfile\"}},[a(\"code\",[a(\"span\",{pre:!0,attrs:{class:\"token instruction\"}},[a(\"span\",{pre:!0,attrs:{class:\"token keyword\"}},[s._v(\"FROM\")]),s._v(\" neilpang/acme.sh\")]),s._v(\"\\n\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"_0x03-编写docker-compose-yml\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x03-编写docker-compose-yml\"}},[s._v(\"#\")]),s._v(\" 0x03 编写docker-compose.yml\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-docker line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-docker\"}},[a(\"code\",[s._v('version: \"3\"\\n\\nservices:\\n  acme.sh:\\n    build:\\n      context: .\\n      dockerfile: ./compose/acme/Dockerfile\\n    container_name: acme\\n    volumes:\\n        - \"./compose/acme/acme.sh:/acme.sh:z\"\\n    command: \\n        '),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# 首次部署需要进入该容器生成证书\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# acme.sh --issue --dns dns_cf -d www.my.domain.com -d my.domain.com\")]),s._v(\"\\n        \"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"# tail -F anything 保持容器运行\")]),s._v(\"\\n      - sh\\n      - -c\\n      - |\\n          acme.sh --issue --dns dns_cf -d my.domain.com\\n          tail -F anything \\n \\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"##### 1. 首次运行时把 nginx 整个代码块都注释掉，\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"##### 2. 执行 docker-compose up --build，目的是首先获得域名ssl证书；\")]),s._v(\"\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"##### 3. 当成功获得域名证书后，再取消 nginx 代码块的注释\")]),s._v('\\n\\n  nginx:\\n    build:\\n      context: .\\n      dockerfile: ./compose/nginx/Dockerfile\\n    container_name: nginx\\n    restart: always\\n    volumes:\\n      - ./wwwroot/my.domain.com/:/wwwroot/my.domain.com/\\n      - ./compose/nginx/log/:/var/log/nginx/:rw\\n    ports: \\n      - \"80:80\"\\n      - \"443:443\"\\n    depends_on:\\n      - acme.sh\\n\\n')])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),a(\"br\")])]),a(\"h2\",{attrs:{id:\"_0x04-启动容器\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x04-启动容器\"}},[s._v(\"#\")]),s._v(\" 0x04 启动容器\")]),s._v(\" \"),a(\"div\",{staticClass:\"language-bash line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-bash\"}},[a(\"code\",[s._v(\"docker-compose up --build\\n\\n\"),a(\"span\",{pre:!0,attrs:{class:\"token comment\"}},[s._v(\"## 或者让容器后台运行\")]),s._v(\"\\n\\ndocker-compose up --build -d\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\")])])])}),[],!1,null,null,null);n.default=t.exports}}]);","extractedComments":[]}